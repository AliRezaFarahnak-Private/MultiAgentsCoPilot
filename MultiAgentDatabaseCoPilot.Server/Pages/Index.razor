@page "/"
@using BlazorComponents.Terminal
@inject SemanticKernelService semanticKernelService

<PageTitle>Index</PageTitle>
<HeadContent>
    <link href="_content/BlazorComponents.Terminal/style.css" rel="stylesheet" />
    <link href="_content/BlazorComponents.Terminal/theme.default.css" rel="stylesheet" />
</HeadContent>

<BlazorTerminal @ref="blazorTerminal" Style="height:600px;" OnCommandEnter="commandEnter" OnAnswerEnter="answerEnter"></BlazorTerminal>

@code {
    protected override void OnAfterRender(bool firstRender)
    {
        base.OnAfterRender(firstRender);
        if (firstRender)
        {
            blazorTerminal.Return();
        }
    }

    private async void commandEnter(TerminalEventArgs eventArgs)
    {

        if (string.IsNullOrEmpty(eventArgs.InputValue))
        {
            blazorTerminal.Return();
            return;
        }

        string userCommand = eventArgs.InputValue.ToLower();

        switch (userCommand)
        {
            case "clear":
                blazorTerminal.Clear();
                break;
            case "help":
            case "?":
                blazorTerminal.RespondText("Try commands: ask, help, clear", true);
                break;
            default:
                var response = await semanticKernelService.TextCompletionAsync(eventArgs.InputValue);
                blazorTerminal.RespondText(response, true);
                break;
        }
    }

    private async void answerEnter(TerminalEventArgs eventArgs)
    {
        blazorTerminal.RespondText($"Answer input: {eventArgs.InputValue}");
        blazorTerminal.Return();
    }

    private BlazorTerminal blazorTerminal = default!;
}
